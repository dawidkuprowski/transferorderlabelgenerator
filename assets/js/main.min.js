function clearLabels(){labelsContainer.innerHTML=""}async function generateQRCodes(e){for await(label of labels)await new QRCode(document.getElementById("qrANC_"+label.id),{width:96,height:96,text:label.normalAnc}),await new QRCode(document.getElementById("qrQTY_"+label.id),{width:96,height:96,text:Number(label.qty).toFixed(0)}),await new QRCode(document.getElementById("qrTO_BIN_"+label.id),{width:96,height:96,text:label.to_bin.replace(/\s/g,"")}),await new QRCode(document.getElementById("qrTR_ORDER_ITEM_"+label.id),{width:96,height:96,text:label.tr_order+label.tr_item});e&&readyToPrint()}function print(){printWindow=window.open("","PRINT","width=840; height=592;"),printWindow.document.write('\n        <html>\n            <head>\n                <title>Transfer Order Labels</title>\n                <link rel="stylesheet" href="./assets/css/label.min.css">\n            </head>\n            <body>');for(const e of labelsContainer.children)printWindow.document.write('<div class="label_container">'),printWindow.document.write(e.innerHTML),printWindow.document.write("</div>");printWindow.document.write("\n            </body>\n        </html>\n    "),refreshApp()}function refreshApp(){clearLabels(),labels=[],document.getElementById("input_file").value="",document.getElementById("button_print").hidden=!0,document.getElementById("input_file_button").hidden=!1,document.getElementById("input_file_button").parentElement.hidden=!1,document.getElementById("input_file_label").innerText="Wybierz dokumenty do skonwertowania."}function readyToPrint(){document.getElementById("input_file_label").innerText='Dokumenty zostały pomyślnie skonwertowane.\nWejdź w podgląd i użyj kombinacji przycisków \n"Ctrl + P" aby wydrukować etykiety.',document.getElementById("button_print").hidden=!1}const labelsContainer=document.getElementById("labels");let labels=[];const qrCodeSize=128;class Label{constructor(e,t,n,i,s,l,a,d,r,o,c,p,v,h){this.id=e,this.date=new Date(86400*(t-25569)*1e3).toLocaleDateString("pl-PL",{year:"numeric",month:"2-digit",day:"2-digit"});const m=new Date(86400*(t-25569)*1e3);this.weekNumber=this.getWeekNumber(m),this.time=this.formatedTime(n),this.normalAnc=i,this.anc=i.replace(/(.{3})/g,"$1 "),this.qty=s,this.from_st=l,this.from_bin=a,this.to_st=d,this.to_bin=r.padStart(8,"0").replace(/\d{2}(?!$)/g,"$& "),this.tr_order=o.padStart(10,"0"),this.tr_item=c.padStart(4,"0"),this.material_description=p,this.user=v,this.unit=h,this.init()}getWeekNumber(e){const t=new Date(e.getFullYear(),0,1),n=Math.ceil(((e-t)/864e5+t.getDay()+1)/7);return 0===e.getDay()&&1!==n?n-1:n}formatedTime(e){const t=24*e,n=Math.floor(t),i=Math.floor(60*(t-n)),s=Math.floor(60*(60*(t-n)-i));return`${String(n).padStart(2,"0")}:${String(i).padStart(2,"0")}:${String(s).padStart(2,"0")}`}init(){labelsContainer.innerHTML+=`\n        <div class="label_container">\n            <div class="row">\n                <div class="col">\n                    <div class="col p0">\n                        <span class="fs-2 fw-7 text-center">${this.date}</span>\n                    </div>\n                    <div class="col p0">\n                        <span class="fs-2 fw-5 text-center">${this.time}</span>\n                    </div>\n                </div>\n                <div class="border_col"></div>\n                <div class="col flex-100 gap-1">\n                    <div class="col p0">\n                        <span class="fs-2 fw-7 text-center">${this.material_description}</span>\n                    </div>\n                </div>\n                <div class="border_col"></div>\n                <div class="col">\n                    <div class="col p0">\n                        <span class="fs-2 fw-6 text-center" style="word-break: break-all;">${this.user}</span>\n                    </div>\n                </div>\n            </div>\n            <div class="border_row"></div>\n            <div class="row">\n                <div class="col flex-100">\n                    <div class="col p0">\n                        <span class="fs-3 fw-6">ANC</span>\n                    </div>\n                    <div class="col p0">\n                        <span class="fs-9 fw-7 text-center">${this.anc}</span>\n                    </div>\n                </div>\n                <div class="border_col"></div>\n                <div class="col p05" id="qrANC_${this.id}">\n                    \n                </div>\n            </div>\n            <div class="border_row"></div>\n            <div class="row">\n                <div class="col p05" id="qrQTY_${this.id}">\n                    \n                </div>\n                <div class="border_col"></div>\n                <div class="col flex-100">\n                    <div class="col p0">\n                        <span class="fs-3 fw-6">QTY</span>\n                    </div>\n                    <div class="col p0">\n                        <span class="fs-9 fw-7 text-center">${this.qty} ${this.unit}</span>\n                    </div>\n                </div>\n            </div>\n            <div class="border_row"></div>\n            <div class="row">\n                <div class="col">\n                    <div class="col p0">\n                        <span class="fs-3 fw-6">TO</span>\n                    </div>\n                    <div class="col p0">\n                        <span class="fs-6 fw-7 text-center">${this.to_st}</span>\n                    </div>\n                </div>\n                <div class="col flex-100">\n                    <div class="col p0">\n                        <span class="fs-11 fw-7 text-center">${this.to_bin}</span>\n                    </div>\n                </div>\n                <div class="border_col"></div>\n                <div class="col p05" id="qrTO_BIN_${this.id}">\n                        \n                </div>\n            </div>\n            <div class="border_row"></div>\n            <div class="row">\n                <div class="col p05" id="qrTR_ORDER_ITEM_${this.id}">\n                            \n                </div>\n                <div class="border_col"></div>\n                <div class="col flex-100">\n                    <div class="col p0">\n                        <span class="fs-3 fw-6">TR.ORDER / ITEM</span>\n                    </div>\n                    <div class="col p0">\n                        <span class="fs-6 fw-7 text-center">${this.tr_order} / ${this.tr_item}</span>\n                    </div>\n                </div>\n                <div class="border_col"></div>\n                <div class="col">\n                    <div class="col p0">\n                        <span class="fs-3 fw-6">WEEK</span>\n                    </div>\n                    <div class="col p0">\n                        <span class="fs-6 fw-7 text-center">${this.weekNumber}</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `,labels.push(this)}}let printWindow;document.getElementById("input_file").addEventListener("change",e=>{null!=printWindow&&printWindow.close();const t=e.target.files;t.length>0&&clearLabels();for(let e=0;e<t.length;e++){document.getElementById("input_file_label").innerText="Generuje etykiety...";let n=new FileReader;n.readAsBinaryString(t[e]),n.onload=(async n=>{let i=n.target.result,s=await XLSX.read(i,{type:"binary"});await s.SheetNames.forEach(async e=>{let t=await XLSX.utils.sheet_to_row_object_array(s.Sheets[e]);for(let e=0;e<t.length;e++){const n=labels.length;let i=Number(t[e]["Creation Date"]),s=Number(t[e]["Creation time"]),l=t[e].Material.toString(),a=t[e]["Source target qty"].toString(),d=t[e]["Source Storage Type"].toString(),r=t[e]["Source Storage Bin"].toString(),o=t[e]["Dest. Storage Type"].toString(),c=t[e]["Dest.Storage Bin"].toString(),p=t[e]["Transfer Order Number"].toString(),v=t[e]["Transfer order item"].toString(),h=t[e]["Material Description"].toString(),m=t[e].User.toString(),w=t[e]["Alternative Unit of Measure"].toString();l.length>9&&(l=l.substr(l.length-9)),new Label(n,i,s,l,a,d,r,o,c,p,v,h,m,w)}}),generateQRCodes(e===t.length-1),document.getElementById("input_file_button").hidden=!0,document.getElementById("input_file_button").parentElement.hidden=!0})}}),refreshApp();